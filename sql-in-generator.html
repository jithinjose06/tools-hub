<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>SQL IN() GENERATOR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css"
    />
    <style>
      body {
        max-width: 600px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        justify-content: center;
        min-height: 100vh; /* vertically centers */
        padding: 16px;
        box-sizing: border-box;
      }

      h1 {
        font-size: 1.5rem;
        margin-bottom: 12px;
        text-align: center;
      }

      label {
        margin: 6px 0 2px;
        font-size: 0.9rem;
      }

      input[type="file"],
      select,
      button,
      textarea {
        margin: 6px 0;
        padding: 8px 10px;
        font-size: 0.95rem;
      }

      fieldset {
        margin: 8px 0;
        padding: 8px 10px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 0.9rem;
      }

      textarea {
        height: 90px; /* shorter so no scroll */
        resize: vertical; /* let user expand if needed */
      }

      .hidden {
        display: none;
      }

      #goBackBtn {
        display: inline-block;
        padding: 10px 20px;
        background: #0077b6;
        color: #fff;
        font-weight: 600;
        font-size: 0.95rem;
        border-radius: 6px;
        text-decoration: none;
        border: none;
        cursor: pointer;
        transition:
          background 0.2s ease,
          box-shadow 0.2s ease,
          transform 0.2s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-top: 10px;
        align-self: center;
      }

      #goBackBtn:hover,
      #goBackBtn:focus {
        background: #0096c7;
        color: #fff;
        box-shadow: 0 6px 20px rgba(0, 150, 199, 0.5);
        transform: scale(1.05);
        outline: none;
      }

      input[type="file"]::file-selector-button {
        background: #0077b6;
        color: #fff;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        transition:
          background 0.2s ease,
          transform 0.2s ease;
      }

      input[type="file"]::file-selector-button:hover {
        background: #0096c7;
        transform: scale(1.05);
      }
      input[type="file"] {
        font-size: 0.9rem;
        border: 1px solid #ccc;
        border-radius: 6px;
        padding: 6px;
        background: #fff;
        color: #333;
      }
    </style>
  </head>
  <body>
    <h1>SQL IN() GENERATOR</h1>

    <input type="file" id="fileInput" accept=".csv, .xlsx, .xls" />
    <progress id="progressBar" max="100" value="0" class="hidden"></progress>
    <p id="errorMessage" style="color: red"></p>

    <label for="columnSelect">Select Column</label>
    <select id="columnSelect">
      <option disabled selected>Upload the file first</option>
    </select>

    <fieldset>
      <legend>Format Output As</legend>
      <label
        ><input type="radio" name="formatType" value="string" checked /> String
        (with quotes)</label
      >
      <label
        ><input type="radio" name="formatType" value="integer" /> Integer (no
        quotes)</label
      >
    </fieldset>

    <button id="convertBtn">Convert</button>
    <textarea
      id="outputText"
      readonly
      placeholder="Converted CSV will appear here..."
    ></textarea>
    <button id="copyBtn">Copy to Clipboard</button>

    <!-- âœ… Back to Home button -->
    <div style="text-align: center; margin-top: 12px">
      <a href="index.html" id="goBackBtn">Go Back to Home</a>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script>
      let parsedData = [];

      document
        .getElementById("fileInput")
        .addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (!file) return;

          document.getElementById("progressBar").classList.remove("hidden");
          document.getElementById("errorMessage").textContent = "";

          const reader = new FileReader();
          reader.onload = function (event) {
            let data = event.target.result;
            let ext = file.name.split(".").pop().toLowerCase();

            if (ext === "csv") {
              const results = Papa.parse(data, { header: true });
              parsedData = results.data;
            } else {
              const workbook = XLSX.read(data, { type: "binary" });
              const sheet = workbook.Sheets[workbook.SheetNames[0]];
              parsedData = XLSX.utils.sheet_to_json(sheet);
            }

            populateColumnDropdown();
            document.getElementById("progressBar").value = 100;
          };

          if (file.name.endsWith(".csv")) {
            reader.readAsText(file);
          } else {
            reader.readAsBinaryString(file);
          }
        });

      function populateColumnDropdown() {
        const dropdown = document.getElementById("columnSelect");
        dropdown.innerHTML = "";

        if (!parsedData.length) return;

        const headers = Object.keys(parsedData[0]);
        headers.forEach((col) => {
          const option = document.createElement("option");
          option.value = col;
          option.textContent = col;
          dropdown.appendChild(option);
        });
      }

      document.getElementById("convertBtn").addEventListener("click", () => {
        const selectedColumn = document.getElementById("columnSelect").value;
        const formatType = document.querySelector(
          'input[name="formatType"]:checked',
        ).value;

        if (!selectedColumn) {
          alert("Please select a column.");
          return;
        }

        const values = parsedData
          .map((row) => row[selectedColumn])
          .map((v) => (typeof v === "string" ? v.trim() : v))
          .filter((v) => v !== undefined && v !== "")
          .filter((v, i, arr) => arr.indexOf(v) === i); // remove duplicates

        const formatted = values
          .map((v) => (formatType === "string" ? `"${v}"` : v))
          .join(",");

        document.getElementById("outputText").value = formatted;
      });

      document.getElementById("copyBtn").addEventListener("click", () => {
        const textArea = document.getElementById("outputText");
        textArea.select();
        document.execCommand("copy");
      });
    </script>
  </body>
</html>
